<html data-bs-theme="dark">

<head>
    <title>Admin Page</title>
    <!-- Bootstrap imports -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
        rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- Datatables import for JQuery -->
    <script src="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-2.1.8/datatables.min.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon"
        href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKcAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAAqAAAAAAAAAAAAAAAAAAAALIAAAD/AAAA4AAAANwAAADcAAAA3AAAANwAAADcAAAA3AAAANwAAADcAAAA4AAAAP8AAACxAAAAAAAAAKYAAAD/AAAAuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC/AAAA/wAAAKkAAAD6AAAAzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAN8AAAD/AAAA+gAAAMMAAAAAAAAAAgAAAGsAAABrAAAAawAAAGsAAABrAAAAawAAAGsAAABrAAAADAAAAAAAAADaAAAA/wAAAPoAAADDAAAAAAAAAIsAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAANEAAAAAAAAA2gAAAP8AAAD6AAAAwwAAAAAAAAAAAAAAMgAAADIAAAAyAAAAMgAAADIAAAAyAAAAMgAAADIAAAAFAAAAAAAAANoAAAD/AAAA+gAAAMMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADaAAAA/wAAAPoAAADDAAAAAAAAADwAAAB8AAAAAAAAAGAAAABcAAAAAAAAAH8AAABKAAAAAAAAAAAAAAAAAAAA2gAAAP8AAAD6AAAAwwAAAAAAAADCAAAA/wAAACkAAADqAAAA4QAAAAAAAAD7AAAA/wAAALAAAAAGAAAAAAAAANoAAAD/AAAA+gAAAMMAAAAAAAAAIwAAAP4AAAD/AAAA/wAAAGAAAAAAAAAAAAAAAMkAAAD/AAAAigAAAAAAAADaAAAA/wAAAPoAAADDAAAAAAAAAAAAAAAIAAAAcAAAABkAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAA2gAAAP8AAAD7AAAAywAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAN4AAAD/AAAAqwAAAP8AAACvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALIAAAD/AAAAsgAAAAAAAAC5AAAA/wAAAMoAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMkAAAD/AAAAvAAAAAAAAAAAAAAAAAAAAKwAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAArQAAAAAAAAAAwAMAAIABAAAf+AAAP/wAAD/8AAAgBAAAP/wAAD/8AAA//AAAJIwAADHEAAA//AAAP/wAAB/4AACAAQAAwAMAAA==" />
    <style>
        /* LIGHT MODE STYLING */
        body {
            background-color: #eee;
        }

        .border-bottom {
            border-color: rgba(0, 0, 0, 0.175) !important;
        }

        .fullscreen,
        .sticky-top,
        body {
            background-color: #eee;
        }

        #version {
            color: #eee;
        }

        .form-switch .form-check-input:not(:checked) {
            background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='black'/></svg>");
            border-color: black;
        }

        /* DARK MODE STYLING */
        .dark-mode :root {
            color-scheme: dark;
        }

        .dark-mode .canvas {
            background: rgba(30, 41, 59, 0.9);
        }

        .dark-mode .modal-content {
            background: #0f172a;
        }

        .dark-mode .border-bottom {
            border-color: rgba(255, 255, 255, 0.15) !important;
        }

        .dark-mode .fullscreen,
        .dark-mode .sticky-top,
        .dark-mode .card,
        .dark-mode body,
        .dark-mode .modal-dialog {
            background: #0f172a;
            color: #eee;
        }

        .dark-mode .list-group-item:not(.disabled),
        .dark-mode .form-label,
        .dark-mode .form-control,
        .dark-mode .form-select,
        .dark-mode #version {
            color: #eee;
        }

        .dark-mode .list-group-item .disabled {
            color: rgba(173, 181, 189, 0.75);
        }

        .dark-mode .form-switch .form-check-input:not(:checked) {
            background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='white'/></svg>");
            border-color: #eee;
        }

        .dark-mode .table>:not(caption)>*>* {
            color: #eee;
        }

        .dark-mode svg {
            color: #eee;
        }

        /* GENERAL STYLING */
        :root {
            font-family: Helvetica, sans-serif;
        }

        .sticky-top {
            padding-top: 6px;
            margin: 0 -0.75rem 0 -0.75rem;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }

        .stats {
            float: right;
            text-align: right;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .card {
            margin-top: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .alert-container {
            z-index: 999;
            top: 100px;
        }

        .alert-container .close {
            position: absolute;
            top: 3px;
            right: 6px;
            width: 10px;
            padding: .75rem 1.25rem;
            color: inherit;
            padding-left: 16px;
        }

        .border,
        .controls {
            min-height: 165px;
        }

        .hideItemText {
            margin-right: auto;
        }

        .moveUp {
            margin: 5px 2px 0px 2px;
            padding: 2px 1px 2px 1px;
            height: 16px !important;
        }

        .moveDown {
            margin: 5px 2px 0px 2px;
            padding: 3px 1px 2px 1px;
            height: 16px !important;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="sticky-top">
            <div class="row border-bottom pb-1">
                <div class="col-auto">
                    <h1>Robot Framework Dashboard Admin Page</h1>
                </div>
                <div class="col-auto align-self-center">
                    <a href="/docs">
                        <button class="btn btn-outline-light btn-sm mt-auto" id="openServerDocs">Open
                            API Docs</button>
                    </a>
                </div>
                <div class="col-auto align-self-center">
                    <button type="button" class="btn btn-outline-light btn-sm mt-auto" data-bs-toggle="modal"
                        data-bs-target="#hideModal">
                        Admin Settings
                    </button>
                </div>
                <div class="col-auto align-self-center">
                    <a href="/dashboard">
                        <button class="btn btn-outline-light btn-sm mt-auto" id="openDashboard">Open
                            Dashboard</button>
                    </a>
                </div>
                <div class="col-2 ms-auto stats">
                    <span id="stats">
                        <i><a id="version" href="https://github.com/timdegroot1996/robotframework-dashboard"
                                target="_blank">"placeholder_version"</a></i>
                    </span>
                </div>
                <div class="position-relative alert-container">
                    <div class="position-absolute top-20 start-50 translate-middle" id="alertContainer"></div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h3>Add output.xml To Database</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">output.xml</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm" for="outputPath">Absolute Path (E.g.
                            "C:/users/your_user/output.xml")</label>
                        <input class="form-control form-control-sm" id="outputPath"></input>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm" for="outputTags">Run Tags (separate with ":")</label>
                        <input class="form-control form-control-sm" id="outputTags"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-light btn-sm mt-auto" id="addOutputPath">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addPathSpinner" hidden></span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">output.xml</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm mt-1" for="outputData">XML Data (copy paste the
                            output.xml
                            here)</label>
                        <textarea class="form-control form-control-sm" id="outputData" rows="10"></textarea>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm mt-1" for="outputDataTags">Run Tags (separate with
                            ":")</label>
                        <input class="form-control form-control-sm" id="outputDataTags"></input>
                        <label class="form-label form-label-sm mt-1" for="outputDataAlias">Run Alias</label>
                        <input class="form-control form-control-sm" id="outputDataAlias"></input>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-outline-light btn-sm" style="margin-top:36px"
                            id="addOutputData">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addDataSpinner" hidden></span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">output folder</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm mt-1" for="outputFolderPath">Absolute Path (E.g.
                            "C:/some_folder/your_output_folder")</label>
                        <input class="form-control form-control-sm" id="outputFolderPath"></input>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm mt-1" for="outputFolderTags">Run Tags (separate with
                            ":")</label>
                        <input class="form-control form-control-sm" id="outputFolderTags"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-light btn-sm mt-auto" id="addOutputFolderPath">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addFolderSpinner" hidden></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h3>Remove output.xml(s) From Database</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by run_start</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm" for="removeRunStarts">E.g. '2025-03-13
                            00:29:15.926420,2025-03-23 20:31:03.541062' (, separated)</label>
                        <input class="form-control form-control-sm" id="removeRunStarts"></input>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by index</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeIndexes">E.g. '1:3;9;13', will remove
                            1,2,3,9,13 (: or ; separated)</label>
                        <input class="form-control form-control-sm" id="removeIndexes"></input>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by alias</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeAliases">E.g. 'alias1,cool_alias_2' (,
                            separated)</label>
                        <input class="form-control form-control-sm" id="removeAliases"></input>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by tag</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeTags">E.g. 'prod,dev,nightly,tag1' (,
                            separated)</label>
                        <input class="form-control form-control-sm" id="removeTags"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-light btn-sm mt-auto" id="removeOutputs">Remove&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="removeSpinner" hidden></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h3>Add/Remove log.html In The Server</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <p>IMPORTANT! The log_name that is provided should be similar to the output.xml that has been
                        uploaded
                        If you added 'output-123.xml' then the log should be 'log-123.html', otherwise the database
                        won't update correctly!</p>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-4">log.html</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm mt-1" for="logData">HTML Data (copy paste the
                            log.html
                            here)</label>
                        <textarea class="form-control form-control-sm" id="logData" rows="10"></textarea>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm mt-1" for="logName">Log Name</label>
                        <input class="form-control form-control-sm" id="logName"></input>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-outline-light btn-sm" style="margin-top:36px" id="addLogData">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addLogDataSpinner" hidden></span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">log.html to remove by name</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeLog">E.g. 'log-20250219-172535.html' or
                            'all' for everything</label>
                        <input class="form-control form-control-sm" id="removeLog"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-light btn-sm mt-auto" id="removeLogData">Remove&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="removeLogDataSpinner" hidden></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h3>Runs In The Database</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <p>Use 'Run ID' or 'Run Start' to remove runs from the database.</p>
                </div>
                <div class="row">
                    <div class="col">
                        <table class="table table-striped table-bordered" id="runTable"></table>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal for hiding graphs/sections -->
        <div class="modal fade" id="hideModal" tabindex="-1" aria-labelledby="hideModalLabel" data-bs-backdrop="static">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title" id="hideModalLabel">Settings</h1>
                        <div>
                            <button type="button" class="btn btn-outline-light btn-sm mt-auto" data-bs-dismiss="modal"
                                id="resetHide">Reset View</button>
                            <button class="btn btn-outline-light btn-sm mt-auto ms-3" id="saveHide"
                                data-bs-dismiss="modal" type="button">Save
                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                    id="saveHideSpinner" hidden></span>
                            </button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="row border-bottom">
                            <h2>General</h2>
                        </div>
                        <div class="row mt-2">
                            <div class="col-4 btn-group ms-1">
                                <label class="form-check-label mt-1" for="toggleTheme">Dark Mode</label>
                            </div>
                            <div class="col btn-group form-switch ms-2">
                                <input class="form-check-input mt-2" type="checkbox" role="switch" id="toggleTheme" />
                            </div>
                        </div>
                        <div class="row border-bottom pt-1">
                            <h2>Customize View</h2>
                        </div>
                        <h4>Admin custom view usage instructions</h4>
                        <ul>
                            <li>You can set which sections and graphs are hidden by default as admin</li>
                            <li>This 'admin hidden settings' are saved in browser local storage and on the server itself
                            </li>
                            <li>If the server is turned off it loses the configuration.
                            <li>If you start the admin page the browser local storage in the admin page should
                                automatically restore the 'admin hidden settings' on first load</li>
                            <li>Above point assumes you are using a machine/browser you have previously used to set the
                                settings!</li>
                            <li>If a user does already have 'hidden settings' the admin settings are ignored even if
                                they are different</li>
                            <li>To view current 'hidden settings' (both admin and user) you can open 'Developer Tools
                                (F12)' > 'Application (App)' > 'Local Storage'</li>
                            <li>Only when refreshing the dashboard page will admin settings be used if they were changed
                                while it was open
                            </li>
                        </ul>
                        <div class="row mt-2">
                            <div class="col">
                                <h4 class="ms-1">Show Sections</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminSectionShow" class="list-group list-group-numbered"></ol>
                                </div>
                            </div>
                            <div class="col-auto mt-5">
                                <div class="controls mt-5">
                                    <button class="btn btn-sm" id="sectionRight"></button>
                                    <button class="btn btn-sm" id="sectionLeft"></button>
                                </div>
                            </div>
                            <div class="col">
                                <h4 class="ms-1">Hide Sections</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminSectionHide" class="list-group"></ol>
                                </div>
                            </div>
                            <div class="col">
                                <h4 class="ms-1">Show Graphs</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminGraphShow" class="list-group list-group-numbered"></ol>
                                </div>
                            </div>
                            <div class="col-auto mt-5">
                                <div class="controls mt-5">
                                    <button class="btn btn-sm" id="graphRight"></button>
                                    <button class="btn btn-sm" id="graphLeft"></button>
                                </div>
                            </div>
                            <div class="col">
                                <h4 class="ms-1">Hide Graphs</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminGraphHide" class="list-group"></ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /////////////////////////////
        // GLOBAL VARIABLE SECTION //
        /////////////////////////////

        // collapse/expand buttons icons/svgs
        const arrowRight =
            '<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 52 52"><g><path fill="currentColor" d="M17.9,4.4l20.7,20.5c0.6,0.6,0.6,1.6,0,2.2L17.9,47.6c-0.6,0.6-1.6,0.6-2.2,0l-2.2-2.2c-0.6-0.6-0.6-1.6,0-2.2l16.3-16.1c0.6-0.6,0.6-1.6,0-2.2L13.6,8.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2C16.4,3.9,17.3,3.9,17.9,4.4z"></path></g></svg>';
        const arrowRightSmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 52 52"><g><path fill="currentColor" d="M17.9,4.4l20.7,20.5c0.6,0.6,0.6,1.6,0,2.2L17.9,47.6c-0.6,0.6-1.6,0.6-2.2,0l-2.2-2.2c-0.6-0.6-0.6-1.6,0-2.2l16.3-16.1c0.6-0.6,0.6-1.6,0-2.2L13.6,8.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2C16.4,3.9,17.3,3.9,17.9,4.4z"></path></g></svg>';
        const arrowDown =
            '<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 52 52"><path fill="currentColor" d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"/></svg>';
        const arrowDownSmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 52 52"><path fill="currentColor" d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"/></svg>';
        const arrowLeft =
            '<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 52 52"><g transform="scale(-1,1) translate(-52,0)"><path fill="currentColor" d="M17.9,4.4l20.7,20.5c0.6,0.6,0.6,1.6,0,2.2L17.9,47.6c-0.6,0.6-1.6,0.6-2.2,0l-2.2-2.2c-0.6-0.6-0.6-1.6,0-2.2l16.3-16.1c0.6-0.6,0.6-1.6,0-2.2L13.6,8.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2C16.4,3.9,17.3,3.9,17.9,4.4z"/></g></svg>';
        const arrowDownVerySmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="8px" height="8px" viewBox="0 0 52 52"><path fill="currentColor" d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"/></svg>';
        const arrowUpVerySmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="8px" height="8px" viewBox="0 0 52 52" transform="matrix(-1,1.2246467991473532e-16,-1.2246467991473532e-16,-1,0,0)"><path fill="currentColor" d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"></path></svg>';

        const hideSections = [
            "Run Statistics",
            "Suite Statistics",
            "Test Statistics",
            "Keyword Statistics",
        ]
        const hideGraphs = [
            "Run Statistics",
            "Run Donut",
            "Run Duration",
            "Run Table",
            "Suite Statistics",
            "Suite Duration",
            "Suite Most Failed",
            "Suite Table",
            "Test Statistics",
            "Test Duration",
            "Test Duration Deviation",
            "Test Messages",
            "Test Most Flaky",
            "Test Recent Most Flaky",
            "Test Most Failed",
            "Test Recent Most Failed",
            "Test Table",
            "Keyword Statistics",
            "Keyword Times Run",
            "Keyword Total Duration",
            "Keyword Average Duration",
            "Keyword Min Duration",
            "Keyword Max Duration",
            "Keyword Table"
        ]
        var hideItem = `<li class="hideItem list-group-item list-group-item-action d-flex {type}">
            <div class="hideItemText">{value}</div>
            <button class="btn btn-sm moveDown"></button>
            <button class="btn btn-sm moveUp"></button>
            </li>`

        /////////////////////////////
        // GENERIC SETUP FUNCTIONS //
        /////////////////////////////

        // function to update the theme when the button is clicked
        function toggle_theme() {
            if (document.documentElement.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'light');
            } else {
                localStorage.setItem('theme', 'dark');
            }
            setup_theme()
        }

        // theme function based on browser/machine color scheme
        function setup_theme() {
            function set_light_mode() {
                // bootstrap dark-mode attribute
                document.getElementsByTagName("html")[0].setAttribute("data-bs-theme", "light");
                // bootstrap default color
                document.documentElement.style.setProperty('--bs-body-bg', '#fff');
                // bootstrap buttons light -> dark
                const buttonsOutlineLight = document.querySelectorAll('.btn-outline-light')
                const buttonsLight = document.querySelectorAll('.btn-light')
                for (const button of buttonsOutlineLight) {
                    button.classList.remove('btn-outline-light');
                    button.classList.add('btn-outline-dark');
                }
                for (const button of buttonsLight) {
                    button.classList.remove('btn-light');
                    button.classList.add('btn-dark');
                }
                // set toggle in correct state if not already, needed on first load to set based on media or localstorage
                if (document.getElementById('toggleTheme').checked) {
                    document.getElementById('toggleTheme').checked = false
                }
                // set the table correctly
                document.getElementById('runTable').classList.remove('table-dark')
                document.getElementById('runTable').classList.add('table-light')
            }

            function set_dark_mode() {
                // bootstrap dark-mode attribute
                document.getElementsByTagName("html")[0].setAttribute("data-bs-theme", "dark");
                // bootstrap light buttons -> dark
                document.documentElement.style.setProperty('--bs-body-bg', 'rgba(30, 41, 59, 0.9)');
                // bootstrap buttons dark -> light
                const buttonsOutlineLight = document.querySelectorAll('.btn-outline-dark')
                const buttonsLight = document.querySelectorAll('.btn-dark')
                for (const button of buttonsOutlineLight) {
                    button.classList.remove('btn-outline-dark');
                    button.classList.add('btn-outline-light');
                }
                for (const button of buttonsLight) {
                    button.classList.remove('btn-dark');
                    button.classList.add('btn-light');
                }
                if (!document.getElementById('toggleTheme').checked) {
                    document.getElementById('toggleTheme').checked = true
                }
                // set the table correctly
                document.getElementById('runTable').classList.remove('table-light')
                document.getElementById('runTable').classList.add('table-dark')
            }

            const theme = localStorage.getItem('theme');
            const root = document.documentElement;
            const isDark = root.classList.contains('dark-mode');
            if (theme === 'light') {
                if (isDark) root.classList.remove('dark-mode');
                set_light_mode();
            } else if (theme === 'dark') {
                if (!isDark) root.classList.add('dark-mode');
                set_dark_mode();
            } else {
                // No theme in localStorage, fall back to system preference
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    root.classList.add('dark-mode');
                    set_dark_mode();
                } else {
                    root.classList.remove('dark-mode');
                    set_light_mode();
                }
            }
        }

        function setup_output_button_eventlisteners() {
            // add eventlisteners to all buttons
            document.getElementById('addOutputPath').addEventListener('click', add_output_path);
            document.getElementById('addOutputData').addEventListener('click', add_output_data);
            document.getElementById('addOutputFolderPath').addEventListener('click', add_output_folder_path);
            document.getElementById('removeOutputs').addEventListener('click', remove_outputs);
            document.getElementById('addLogData').addEventListener('click', add_log);
            document.getElementById('removeLogData').addEventListener('click', remove_log);

        }

        // function to add eventlisteners
        function setup_customize_view_button_eventlisteners() {
            document.getElementById('toggleTheme').addEventListener('click', function () {
                toggle_theme()
            });

            document.getElementById('saveHide').addEventListener('click', function () {
                update_customize_view_local_storage();
                set_customized_view_config();
            });

            // remove the entire customized view configuration
            document.getElementById('resetHide').addEventListener('click', function () {
                localStorage.setItem('adminSectionHide', JSON.stringify([])); // Reset as empty array
                localStorage.setItem('adminGraphHide', JSON.stringify([])); // Reset as empty array
                localStorage.setItem('adminSectionShow', JSON.stringify(hideSections))
                localStorage.setItem('adminGraphShow', JSON.stringify(hideGraphs))
                setup_customize_view_content(); // Re-initialize the modal items
                update_customize_view_local_storage();
                set_customized_view_config();
            });
        }

        // function to add an alert to the admin page
        function add_alert(message, category) {
            const alertHTML = `<div class="row alert alert-${category} alert-dismissible" role="alert" style="padding-right:46px;">
                ${message}
                <span onclick="close_alert()" type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </span>
            </div>`
            document.getElementById('alertContainer').innerHTML = alertHTML

        }

        // function to close the alerts
        function close_alert() {
            document.getElementById('alertContainer').innerHTML = ''
        }

        //////////////////////////////////
        // SERVER INTERACTION FUNCTIONS //
        //////////////////////////////////

        // function to add an output to the database based on a path
        function add_output_path() {
            document.getElementById('addPathSpinner').hidden = false
            const outputPath = document.getElementById('outputPath').value
            const outputTags = document.getElementById('outputTags').value.split(':')
            document.getElementById('outputPath').value = ''
            document.getElementById('outputTags').value = ''

            const body = JSON.stringify({
                output_path: outputPath,
                output_tags: outputTags,
            });
            send_request("POST", "/add-outputs", body, 'addPathSpinner')
        }

        // function to add an output to the database based on raw data
        function add_output_data() {
            document.getElementById('addDataSpinner').hidden = false
            const outputData = document.getElementById('outputData').value
            const outputDataTags = document.getElementById('outputDataTags').value.split(':')
            const outputAlias = document.getElementById('outputDataAlias').value
            document.getElementById('outputData').value = ''
            document.getElementById('outputDataTags').value = ''
            document.getElementById('outputDataAlias').value = ''

            const body = JSON.stringify({
                output_data: outputData,
                output_tags: outputDataTags,
                output_alias: outputAlias,
            });
            send_request("POST", "/add-outputs", body, 'addDataSpinner')
        }

        // function to add output(s) to the database based on a folder path
        function add_output_folder_path() {
            document.getElementById('addFolderSpinner').hidden = false
            const outputFolderPath = document.getElementById('outputFolderPath').value
            const outputFolderTags = document.getElementById('outputFolderTags').value.split(':')
            document.getElementById('outputFolderPath').value = ''
            document.getElementById('outputFolderTags').value = ''

            const body = JSON.stringify({
                output_folder_path: outputFolderPath,
                output_tags: outputFolderTags,
            });
            send_request("POST", "/add-outputs", body, 'addFolderSpinner')
        }

        // function to remove outputs from the database
        function remove_outputs() {
            document.getElementById('removeSpinner').hidden = false
            var [data, run_starts, indexes, aliases, tags] = [{}, [], [], [], []]
            const removeRunStarts = document.getElementById('removeRunStarts').value.split(',')
            for (const runStart of removeRunStarts) {
                if (runStart == '') { continue }
                run_starts.push(runStart)
            }
            if (run_starts.length > 0) { data['run_starts'] = run_starts }
            const removeIndexes = document.getElementById('removeIndexes').value.split(';')
            for (const index of removeIndexes) {
                if (index == '') { continue }
                indexes.push(index)
            }
            if (indexes.length > 0) { data['indexes'] = indexes }
            const removeAliases = document.getElementById('removeAliases').value.split(',')
            for (const removeAlias of removeAliases) {
                if (removeAlias == '') { continue }
                aliases.push(removeAlias)
            }
            if (aliases.length > 0) { data['aliases'] = aliases }
            const removeTags = document.getElementById('removeTags').value.split(',')
            for (const removeTag of removeTags) {
                if (removeTag == '') { continue }
                tags.push(removeTag)
            }
            if (tags.length > 0) { data['tags'] = tags }
            document.getElementById('removeRunStarts').value = ''
            document.getElementById('removeIndexes').value = ''
            document.getElementById('removeAliases').value = ''
            document.getElementById('removeTags').value = ''
            const body = JSON.stringify(data)
            send_request("DELETE", "/remove-outputs", body, 'removeSpinner')
        }

        // function to retrieve all outputs currently in the database
        function get_outputs() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/get-outputs");
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    const runs = JSON.parse(xhr.responseText)
                    let table = '<tr><th>Run Index</th><th>Run Start</th><th>Run Name</th><th>Run Alias</th><th>Run Tags</th></tr>'
                    for (const [index, run] of runs.entries()) {
                        table += `<tr><td>${index}</td><td>${run.run_start}</td><td>${run.name}</td><td>${run.alias}</td><td>${run.tags}</td></tr>`
                    }
                    document.getElementById('runTable').innerHTML = table
                } else {
                    add_alert(`Error: ${xhr.status}, ${xhr.responseText}`, 'danger')
                }
            };
            xhr.send();
        }

        // function to set the customized view config
        function set_customized_view_config(notifications = true) {
            const adminSectionHide = localStorage.getItem('adminSectionHide');
            const adminGraphHide = localStorage.getItem('adminGraphHide');
            const adminSectionShow = localStorage.getItem('adminSectionShow');
            const adminGraphShow = localStorage.getItem('adminGraphShow');
            document.getElementById('saveHideSpinner').hidden = false
            const body = JSON.stringify({
                admin_section_hide: adminSectionHide,
                admin_graph_hide: adminGraphHide,
                admin_section_show: adminSectionShow,
                admin_graph_show: adminGraphShow,
            });
            send_request("POST", "set-customized-view-config", body, 'saveHideSpinner', notifications)
        }

        // function to get the customized view config
        function get_customized_view_config() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/get-customized-view-config");
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    const config = JSON.parse(xhr.responseText)
                    const adminSectionHide = JSON.parse(localStorage.getItem('adminSectionHide'))
                    const adminGraphHide = JSON.parse(localStorage.getItem('adminGraphHide'))
                    const adminSectionShow = JSON.parse(localStorage.getItem('adminSectionShow'))
                    const adminGraphShow = JSON.parse(localStorage.getItem('adminGraphShow'))
                    if (adminSectionHide.length == 0 && adminGraphHide.length == 0 && adminSectionShow.length == 0 && adminGraphShow.length == 0) {
                        if (config.admin_section_hide.length > 2 && config.admin_graph_hide.length > 2 && config.admin_section_show.length > 2 && config.admin_graph_show.length > 2) {
                            // if the admin config is not empty use the server side admin config
                            localStorage.setItem('adminSectionHide', JSON.stringify(JSON.parse(config.admin_section_hide)))
                            localStorage.setItem('adminGraphHide', JSON.stringify(JSON.parse(config.admin_graph_hide)))
                            localStorage.setItem('adminSectionShow', JSON.stringify(JSON.parse(config.admin_section_show)))
                            localStorage.setItem('adminGraphShow', JSON.stringify(JSON.parse(config.admin_graph_show)))
                        } else {
                            // if the admin config is empty add the default values
                            localStorage.setItem('adminSectionShow', JSON.stringify(hideSections))
                            localStorage.setItem('adminGraphShow', JSON.stringify(hideGraphs))
                        }
                    } else {
                        // Below exception is created to handle problems when switching between old versions without graphs
                        // to newer versions with additional graphs. The view is completely reset to add all graphs again.
                        if (hideGraphs.length != (Object.keys(adminGraphShow).length + Object.keys(adminGraphHide).length)) {
                            localStorage.setItem('adminSectionHide', JSON.stringify([]));
                            localStorage.setItem('adminGraphHide', JSON.stringify([]));
                            localStorage.setItem('adminSectionShow', JSON.stringify(hideSections));
                            localStorage.setItem('adminGraphShow', JSON.stringify(hideGraphs));
                        }
                    }
                    // 2 functions below should alwyas be here to make sure the server side config is actually present
                    setup_customize_view_content() // fill the modal with the correct content
                    set_customized_view_config(false) // if there is a local storage already in place update that on server side
                } else {
                    add_alert(`Error: ${xhr.status}, ${xhr.responseText}`, 'danger')
                }
            };
            xhr.send();
        }

        // function to send requests (helper function for other functions that do similar server requests)
        function send_request(method, endpoint, body, spinner, notifications = true) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, endpoint);
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    document.getElementById(spinner).hidden = true
                    response = JSON.parse(xhr.responseText);
                    if (response.success == '1') {
                        console.log(response.console)
                        if (notifications) {
                            if (response.console.includes('ERROR')) {
                                add_alert('SUCCESS: The processing was handled but some errors occurred, see the browser console for more details!', 'warning')
                            } else {
                                add_alert(response.message, 'success')
                            }
                        }
                    } else {
                        add_alert(response.message, 'danger')
                        console.log(response.console)
                    }
                    get_outputs()
                } else {
                    document.getElementById(spinner).hidden = true
                    add_alert(`Error: ${xhr.status}, ${xhr.responseText}`, 'danger')
                }
            };
            xhr.send(body);
        }

        // function to add a logs raw data to the server and update the database
        function add_log() {
            document.getElementById('addLogDataSpinner').hidden = false
            const logData = document.getElementById('logData').value
            const logName = document.getElementById('logName').value
            document.getElementById('logData').value = ''
            document.getElementById('logName').value = ''

            const body = JSON.stringify({
                log_data: logData,
                log_name: logName,
            });
            send_request("POST", "/add-log", body, 'addLogDataSpinner')
        }

        // function to remove outputs from the database
        function remove_log() {
            document.getElementById('removeLogDataSpinner').hidden = false
            const removeLog = document.getElementById('removeLog').value
            document.getElementById('removeLog').value = ''
            const body = JSON.stringify({
                log_name: removeLog,
            });
            send_request("DELETE", "/remove-log", body, 'removeLogDataSpinner')
        }

        //////////////////////////////
        // CUSTOMIZE VIEW FUNCTIONS //
        //////////////////////////////

        // Updated localStorage setup with backward compatibility
        function setup_customize_view_local_storage() {
            const keys = [
                'adminSectionShow', 'adminSectionHide',
                'adminGraphShow', 'adminGraphHide'
            ];

            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value === null) {
                    localStorage.setItem(key, JSON.stringify([]));
                } else if (!value.trim().startsWith('[')) {
                    // Convert old comma-separated string to JSON array
                    const parsed = value.split(',')
                        .map(s => s.trim().replace(/^'|'$/g, ''))
                        .filter(Boolean);
                    localStorage.setItem(key, JSON.stringify(parsed));
                }
            });
        }

        function setup_customize_view_arrow_eventlisteners() {
            // function to move the items from showing to hidden
            function move_items(fromId, toId) {
                const fromBox = document.getElementById(fromId);
                const toBox = document.getElementById(toId);
                const selectedItems = fromBox.querySelectorAll('.active');

                const fromStorage = JSON.parse(localStorage.getItem(fromId));
                const toStorage = JSON.parse(localStorage.getItem(toId));

                for (let item of selectedItems) {
                    const val = item.children[0].innerText;
                    if (toId.includes('Hide')) {
                        if (!toStorage.includes(val)) toStorage.push(val);
                        const identifier = val.split(" ")[0];
                        if (toId.includes('Section')) disable_graphs_in_customize_view(true, identifier);
                    } else {
                        const index = fromStorage.indexOf(val);
                        if (index !== -1) fromStorage.splice(index, 1);
                        const identifier = val.split(" ")[0];
                        if (toId.includes('Section')) disable_graphs_in_customize_view(false, identifier);
                    }
                }

                localStorage.setItem(fromId, JSON.stringify(fromStorage));
                localStorage.setItem(toId, JSON.stringify(toStorage));

                selectedItems.forEach(item => {
                    item.classList.remove('active');
                    if (toId === 'adminGraphShow') {
                        const section = item.children[0].innerText.split(' ')[0];
                        const listItems = document.getElementById('adminGraphShow').querySelectorAll('.hideItem');
                        let lastMatchingItem = Array.from(listItems).reverse().find(li => {
                            return li.children[0].innerText.startsWith(section);
                        }) || listItems[listItems.length - 1];
                        lastMatchingItem?.after(item);
                    } else {
                        toBox.appendChild(item);
                    }
                });
            }

            const arrowMappings = {
                'sectionRight': { from: 'adminSectionShow', to: 'adminSectionHide', content: arrowRight },
                'sectionLeft': { from: 'adminSectionHide', to: 'adminSectionShow', content: arrowLeft },
                'graphRight': { from: 'adminGraphShow', to: 'adminGraphHide', content: arrowRight },
                'graphLeft': { from: 'adminGraphHide', to: 'adminGraphShow', content: arrowLeft }
            };

            for (let arrow in arrowMappings) {
                const { from, to, content } = arrowMappings[arrow];
                update_arrow_button(arrow, content);
                document.getElementById(arrow).addEventListener("click", () => move_items(from, to));
            }

            function update_arrow_button(id, content) {
                document.getElementById(id).innerHTML = content;
            }
        }

        function disable_graphs_in_customize_view(disable, identifier) {
            const allGraphs = [...document.getElementById("adminGraphShow").querySelectorAll(".hideItemText"),
            ...document.getElementById("adminGraphHide").querySelectorAll(".hideItemText")];
            for (const graph of allGraphs) {
                if (graph.innerText.startsWith(identifier)) {
                    if (disable) {
                        graph.parentElement.classList.add('disabled');
                    } else {
                        graph.parentElement.classList.remove('disabled');
                    }
                }
            }
        }

        function setup_customize_view_content() {
            const graphShow = JSON.parse(localStorage.getItem('adminGraphShow'));
            const graphHide = JSON.parse(localStorage.getItem('adminGraphHide'));
            const sectionShow = JSON.parse(localStorage.getItem('adminSectionShow'));
            const sectionHide = JSON.parse(localStorage.getItem('adminSectionHide'));

            let graphShowItems = '', graphHideItems = '';
            let sectionShowItems = '', sectionHideItems = '';

            for (let graph of [...graphShow, ...graphHide]) {
                const element = hideItem.replaceAll('{value}', graph).replaceAll('{type}', 'graph');
                if (graphHide.includes(graph)) {
                    graphHideItems += element;
                } else {
                    graphShowItems += element;
                }
            }
            document.getElementById('adminGraphShow').innerHTML = graphShowItems;
            document.getElementById('adminGraphHide').innerHTML = graphHideItems;

            for (let section of [...sectionShow, ...sectionHide]) {
                const element = hideItem.replaceAll('{value}', section).replaceAll('{type}', 'section');
                if (sectionHide.includes(section)) {
                    const identifier = section.split(' ')[0];
                    disable_graphs_in_customize_view(true, identifier);
                    sectionHideItems += element;
                } else {
                    sectionShowItems += element;
                }
            }
            document.getElementById('adminSectionShow').innerHTML = sectionShowItems;
            document.getElementById('adminSectionHide').innerHTML = sectionHideItems;

            document.querySelectorAll('.graph .moveUp, .section .moveUp').forEach(item => {
                item.innerHTML = arrowUpVerySmall;
                item.addEventListener('click', function (event) {
                    const before = $(this).parent().prev();
                    if (before.length) $(this).parent().insertBefore(before);
                    event.stopPropagation();
                });
            });

            document.querySelectorAll('.graph .moveDown, .section .moveDown').forEach(item => {
                item.innerHTML = arrowDownVerySmall;
                item.addEventListener('click', function (event) {
                    const after = $(this).parent().next();
                    if (after.length) $(this).parent().insertAfter(after);
                    event.stopPropagation();
                });
            });

            document.querySelectorAll('.hideItem').forEach(item => {
                item.addEventListener('click', function () {
                    this.classList.toggle('active');
                });
            });

        }

        function update_customize_view_local_storage() {
            // Sync current order to localStorage
            const sectionOrder = Array.from(document.getElementById('adminSectionShow').querySelectorAll('.hideItem'))
                .map(item => item.children[0].innerText);
            const graphOrder = Array.from(document.getElementById('adminGraphShow').querySelectorAll('.hideItem'))
                .map(item => item.children[0].innerText);

            localStorage.setItem('adminSectionShow', JSON.stringify(sectionOrder));
            localStorage.setItem('adminGraphShow', JSON.stringify(graphOrder));
        }

        ///////////////////////////
        // MAIN FUNCTION ON LOAD //
        ///////////////////////////

        // function that triggers all functions that should be executed when the dashboard is loaded first
        // in the correct order!
        function main() {
            setup_theme();
            setup_output_button_eventlisteners();
            setup_customize_view_button_eventlisteners();
            setup_customize_view_arrow_eventlisteners();
            setup_customize_view_local_storage();
            get_customized_view_config(); // get server side config if it exists and update local storage (if it is not already filled) and the modal
            get_outputs();
        }

        // trigger of first load
        main()
    </script>

</body>

</html>