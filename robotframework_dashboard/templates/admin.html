<html data-bs-theme="dark">

<head>
    <title>Admin Page</title>
    <!-- Bootstrap imports -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
        rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- Datatables import for JQuery -->
    <script src="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-2.1.8/datatables.min.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon"
        href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKcAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAAqAAAAAAAAAAAAAAAAAAAALIAAAD/AAAA4AAAANwAAADcAAAA3AAAANwAAADcAAAA3AAAANwAAADcAAAA4AAAAP8AAACxAAAAAAAAAKYAAAD/AAAAuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC/AAAA/wAAAKkAAAD6AAAAzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAN8AAAD/AAAA+gAAAMMAAAAAAAAAAgAAAGsAAABrAAAAawAAAGsAAABrAAAAawAAAGsAAABrAAAADAAAAAAAAADaAAAA/wAAAPoAAADDAAAAAAAAAIsAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAANEAAAAAAAAA2gAAAP8AAAD6AAAAwwAAAAAAAAAAAAAAMgAAADIAAAAyAAAAMgAAADIAAAAyAAAAMgAAADIAAAAFAAAAAAAAANoAAAD/AAAA+gAAAMMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADaAAAA/wAAAPoAAADDAAAAAAAAADwAAAB8AAAAAAAAAGAAAABcAAAAAAAAAH8AAABKAAAAAAAAAAAAAAAAAAAA2gAAAP8AAAD6AAAAwwAAAAAAAADCAAAA/wAAACkAAADqAAAA4QAAAAAAAAD7AAAA/wAAALAAAAAGAAAAAAAAANoAAAD/AAAA+gAAAMMAAAAAAAAAIwAAAP4AAAD/AAAA/wAAAGAAAAAAAAAAAAAAAMkAAAD/AAAAigAAAAAAAADaAAAA/wAAAPoAAADDAAAAAAAAAAAAAAAIAAAAcAAAABkAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAA2gAAAP8AAAD7AAAAywAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAN4AAAD/AAAAqwAAAP8AAACvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALIAAAD/AAAAsgAAAAAAAAC5AAAA/wAAAMoAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMkAAAD/AAAAvAAAAAAAAAAAAAAAAAAAAKwAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAArQAAAAAAAAAAwAMAAIABAAAf+AAAP/wAAD/8AAAgBAAAP/wAAD/8AAA//AAAJIwAADHEAAA//AAAP/wAAB/4AACAAQAAwAMAAA==" />

    <style>
        :root {
            font-family: Helvetica, sans-serif;
        }

        @media (prefers-color-scheme: light) {
            body {
                background-color: #eee;
            }
        }

        @media (prefers-color-scheme: dark) {
            :root {
                color-scheme: dark;
            }
        }

        .stats {
            float: right;
            text-align: right;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .card {
            margin-bottom: 10px;
        }

        .alert-container {
            z-index: 999;
            top: 100px;
        }

        .alert-container .close {
            position: absolute;
            top: 3px;
            right: 6px;
            width: 10px;
            padding: .75rem 1.25rem;
            color: inherit;
            padding-left: 16px;
        }

        .border,
        .controls {
            min-height: 165px;
        }

        .hideItemText {
            margin-right: auto;
        }

        .moveUp {
            margin: 5px 2px 0px 2px;
            padding: 2px 1px 2px 1px;
            height: 16px !important;
        }

        .moveDown {
            margin: 5px 2px 0px 2px;
            padding: 3px 1px 2px 1px;
            height: 16px !important;
        }
    </style>
</head>

<body>
    <div class="container-fluid mt-4">
        <div class="position-relative alert-container">
            <div class="position-absolute top-50 start-50 translate-middle" id="alertContainer"></div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-auto">
                        <h1>Robot Framework Dashboard Admin Page</h1>
                    </div>
                    <div class="col-auto align-self-center">
                        <a href="/docs">
                            <button class="btn btn-outline-primary btn-sm mt-auto" id="openServerDocs">Open
                                API Docs</button>
                        </a>
                    </div>
                    <div class="col-auto align-self-center">
                        <button type="button" class="btn btn-outline-primary btn-sm mt-auto" data-bs-toggle="modal"
                            data-bs-target="#hideModal">
                            Customize Admin View
                        </button>
                    </div>
                    <div class="col-auto align-self-center">
                        <a href="/dashboard">
                            <button class="btn btn-outline-primary btn-sm mt-auto" id="openDashboard">Open
                                Dashboard</button>
                        </a>
                    </div>
                    <div class="col-2 ms-auto stats">
                        <span id="stats">
                            <i><a href="https://github.com/timdegroot1996/robotframework-dashboard"
                                    target="_blank">"placeholder_version"</a></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <h2>Add output.xml To Database</h2>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">output.xml</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm" for="outputPath">Absolute Path (E.g.
                            "C:/users/your_user/output.xml")</label>
                        <input class="form-control form-control-sm" id="outputPath"></input>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm" for="outputTags">Run Tags (separate with ":")</label>
                        <input class="form-control form-control-sm" id="outputTags"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-primary btn-sm mt-auto" id="addOutputPath">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addPathSpinner" hidden></span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">output.xml</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm mt-1" for="outputData">XML Data (copy paste the
                            output.xml
                            here)</label>
                        <textarea class="form-control form-control-sm" id="outputData" rows="10"></textarea>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm mt-1" for="outputDataTags">Run Tags (separate with
                            ":")</label>
                        <input class="form-control form-control-sm" id="outputDataTags"></input>
                        <label class="form-label form-label-sm mt-1" for="outputDataAlias">Run Alias</label>
                        <input class="form-control form-control-sm" id="outputDataAlias"></input>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-outline-primary btn-sm" style="margin-top:36px"
                            id="addOutputData">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addDataSpinner" hidden></span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">output folder</p>
                    </div>
                    <div class="col-5">
                        <label class="form-label form-label-sm mt-1" for="outputFolderPath">Absolute Path (E.g.
                            "C:/some_folder/your_output_folder")</label>
                        <input class="form-control form-control-sm" id="outputFolderPath"></input>
                    </div>
                    <div class="col-3">
                        <label class="form-label form-label-sm mt-1" for="outputFolderTags">Run Tags (separate with
                            ":")</label>
                        <input class="form-control form-control-sm" id="outputFolderTags"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-primary btn-sm mt-auto" id="addOutputFolderPath">Add&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="addFolderSpinner" hidden></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <h2>Remove output.xml(s) From Database</h2>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by run_start</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm" for="removeRunStarts">E.g. '2025-03-13
                            00:29:15.926420,2025-03-23 20:31:03.541062' (, separated)</label>
                        <input class="form-control form-control-sm" id="removeRunStarts"></input>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by index</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeIndexes">E.g. '1:3;9;13', will remove
                            1,2,3,9,13 (: or ; separated)</label>
                        <input class="form-control form-control-sm" id="removeIndexes"></input>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by alias</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeAliases">E.g. 'alias1,cool_alias_2' (,
                            separated)</label>
                        <input class="form-control form-control-sm" id="removeAliases"></input>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 d-flex">
                        <p class="mt-auto">outputs to remove by tag</p>
                    </div>
                    <div class="col-8">
                        <label class="form-label form-label-sm mt-1" for="removeTags">E.g. 'prod,dev,nightly,tag1' (,
                            separated)</label>
                        <input class="form-control form-control-sm" id="removeTags"></input>
                    </div>
                    <div class="col-2 d-flex">
                        <button class="btn btn-outline-primary btn-sm mt-auto" id="removeOutputs">Remove&nbsp;
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                id="removeSpinner" hidden></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <h2>Runs In The Database</h2>
                    <p>Use 'Run ID' or 'Run Start' to remove runs from the database.</p>
                </div>
                <div class="row">
                    <div class="col">
                        <table class="table table-striped table-dark table-bordered" id="runTable"></table>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal for hiding graphs/sections -->
        <div class="modal fade" id="hideModal" tabindex="-1" aria-labelledby="hideModalLabel" data-bs-backdrop="static">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title" id="hideModalLabel">Customize View</h1>
                        <div>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-auto" data-bs-dismiss="modal"
                                id="resetView">Reset View</button>
                            <button class="btn btn-outline-primary btn-sm mt-auto ms-3" id="saveHide"
                                data-bs-dismiss="modal" type="button">Save
                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                                    id="saveHideSpinner" hidden></span>
                            </button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <h4>Admin custom view usage instructions</h4>
                        <ul>
                            <li>You can set which sections and graphs are hidden by default as admin</li>
                            <li>This 'admin hidden settings' are saved in browser local storage and on the server itself
                            </li>
                            <li>If the server is turned off it loses the configuration.
                            <li>If you start the admin page the browser local storage in the admin page should
                                automatically restore the 'admin hidden settings' on first load</li>
                            <li>Above point assumes you are using a machine/browser you have previously used to set the
                                settings!</li>
                            <li>If a user does already have 'hidden settings' the admin settings are ignored even if
                                they are different</li>
                            <li>To view current 'hidden settings' (both admin and user) you can open 'Developer Tools
                                (F12)' > 'Application (App)' > 'Local Storage'</li>
                            <li>Only when refreshing the dashboard page will admin settings be used if they were changed
                                while it was open
                            </li>
                        </ul>
                        <div class="row justify-content-evenly">
                            <div class="col">
                                <h2>Sections</h2>
                            </div>
                            <div class="col">
                                <h2>Graphs</h2>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col">
                                <h4>Show</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminSectionShow" class="list-group list-group-numbered"></ol>
                                </div>
                            </div>
                            <div class="col-auto mt-5">
                                <div class="controls mt-5">
                                    <button class="btn btn-sm btn-secondary" id="sectionRight"></button>
                                    <button class="btn btn-sm btn-secondary" id="sectionLeft"></button>
                                </div>
                            </div>
                            <div class="col">
                                <h4>Hide</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminSectionHide" class="list-group"></ol>
                                </div>
                            </div>
                            <div class="col">
                                <h4>Show</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminGraphShow" class="list-group list-group-numbered"></ol>
                                </div>
                            </div>
                            <div class="col-auto mt-5">
                                <div class="controls mt-5">
                                    <button class="btn btn-sm btn-secondary" id="graphRight"></button>
                                    <button class="btn btn-sm btn-secondary" id="graphLeft"></button>
                                </div>
                            </div>
                            <div class="col">
                                <h4>Hide</h4>
                                <div class="border border-3 rounded-3">
                                    <ol id="adminGraphHide" class="list-group"></ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /////////////////////////////
        // GLOBAL VARIABLE SECTION //
        /////////////////////////////

        // collapse/expand buttons icons/svgs
        const arrowRight =
            '<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 52 52"><g><path d="M17.9,4.4l20.7,20.5c0.6,0.6,0.6,1.6,0,2.2L17.9,47.6c-0.6,0.6-1.6,0.6-2.2,0l-2.2-2.2c-0.6-0.6-0.6-1.6,0-2.2l16.3-16.1c0.6-0.6,0.6-1.6,0-2.2L13.6,8.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2C16.4,3.9,17.3,3.9,17.9,4.4z"></path></g></svg>';
        const arrowRightSmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 52 52"><g><path d="M17.9,4.4l20.7,20.5c0.6,0.6,0.6,1.6,0,2.2L17.9,47.6c-0.6,0.6-1.6,0.6-2.2,0l-2.2-2.2c-0.6-0.6-0.6-1.6,0-2.2l16.3-16.1c0.6-0.6,0.6-1.6,0-2.2L13.6,8.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2C16.4,3.9,17.3,3.9,17.9,4.4z"></path></g></svg>';
        const arrowDown =
            '<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 52 52"><path d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"/></svg>';
        const arrowDownSmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 52 52"><path d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"/></svg>';
        const arrowLeft =
            '<svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" viewBox="0 0 52 52"><g transform="scale(-1,1) translate(-52,0)"><path d="M17.9,4.4l20.7,20.5c0.6,0.6,0.6,1.6,0,2.2L17.9,47.6c-0.6,0.6-1.6,0.6-2.2,0l-2.2-2.2c-0.6-0.6-0.6-1.6,0-2.2l16.3-16.1c0.6-0.6,0.6-1.6,0-2.2L13.6,8.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2C16.4,3.9,17.3,3.9,17.9,4.4z"/></g></svg>';
        const arrowDownVerySmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="8px" height="8px" viewBox="0 0 52 52"><path d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"/></svg>';
        const arrowUpVerySmall =
            '<svg xmlns="http://www.w3.org/2000/svg" width="8px" height="8px" viewBox="0 0 52 52" transform="matrix(-1,1.2246467991473532e-16,-1.2246467991473532e-16,-1,0,0)"><path d="M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"></path></svg>';

        const hideSections = [
            'Run Statistics',
            'Suite Statistics',
            'Test Statistics',
            'Keyword Statistics',
        ]
        const hideGraphs = [
            'Run Statistics',
            'Run Duration',
            'Run Table',
            'Suite Statistics',
            'Suite Duration',
            'Suite Most Failed',
            'Suite Table',
            'Test Statistics',
            'Test Duration',
            'Test Duration Deviation',
            'Test Most Flaky',
            'Test Recent Most Flaky',
            'Test Most Failed',
            'Test Messages',
            'Test Table',
            'Keyword Statistics',
            'Keyword Times Run',
            'Keyword Total Duration',
            'Keyword Average Duration',
            'Keyword Min Duration',
            'Keyword Max Duration',
            'Keyword Table'
        ]
        var hideItem = `<li class="hideItem list-group-item list-group-item-action d-flex {type}">
            <div class="hideItemText">{value}</div>
            <button class="btn btn-sm btn-secondary moveDown"></button>
            <button class="btn btn-sm btn-secondary moveUp"></button>
            </li>`

        /////////////////////////////
        // GENERIC SETUP FUNCTIONS //
        /////////////////////////////

        // theme function based on browser/machine color scheme
        function setup_theme() {
            if (!window.matchMedia("(prefers-color-scheme: dark)").matches) {
                document.getElementsByTagName("html")[0].setAttribute("data-bs-theme", "light");
                document.getElementById('runTable').classList.remove('table-dark')
                document.getElementById('runTable').classList.add('table-light')
            }
        }

        // function to add eventlisteners
        function setup_eventlisteners() {
            // add eventlisteners to all buttons
            document.getElementById('addOutputPath').addEventListener('click', add_output_path)
            document.getElementById('addOutputData').addEventListener('click', add_output_data)
            document.getElementById('addOutputFolderPath').addEventListener('click', add_output_folder_path)
            document.getElementById('removeOutputs').addEventListener('click', remove_outputs)
            document.getElementById('saveHide').addEventListener('click', function () {
                var sectionShow = ''
                var graphShow = ''
                document.getElementById('adminSectionShow').querySelectorAll('.hideItemText').forEach(item => {
                    sectionShow += `'${item.innerText}',`
                });
                document.getElementById('adminGraphShow').querySelectorAll('.hideItemText').forEach(item => {
                    graphShow += `'${item.innerText}',`
                });
                localStorage.setItem('adminSectionShow', sectionShow)
                localStorage.setItem('adminGraphShow', graphShow)
                set_customized_view_config()
            });

            // remove the entire customized view configuration
            document.getElementById('resetView').addEventListener('click', function () {
                localStorage.setItem('adminSectionHide', '')
                localStorage.setItem('adminSectionShow', '')
                localStorage.setItem('adminGraphHide', '')
                localStorage.setItem('adminGraphShow', '')
                setup_modal_items()
                set_customized_view_config()
            });
        }

        // function to add an alert to the admin page
        function add_alert(message, category) {
            const alertHTML = `<div class="row alert alert-${category} alert-dismissible" role="alert" style="padding-right:46px;">
                ${message}
                <span onclick="close_alert()" type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </span>
            </div>`
            document.getElementById('alertContainer').innerHTML = alertHTML

        }

        // function to close the alerts
        function close_alert() {
            document.getElementById('alertContainer').innerHTML = ''
        }

        //////////////////////////////////
        // SERVER INTERACTION FUNCTIONS //
        //////////////////////////////////

        // function to add an output to the database based on a path
        function add_output_path() {
            document.getElementById('addPathSpinner').hidden = false
            const outputPath = document.getElementById('outputPath').value
            const outputTags = document.getElementById('outputTags').value.split(':')
            document.getElementById('outputPath').value = ''
            document.getElementById('outputTags').value = ''

            const body = JSON.stringify({
                output_path: outputPath,
                output_tags: outputTags,
            });
            send_request("POST", "/add-outputs", body, 'addPathSpinner')
        }

        // function to add an output to the database based on raw data
        function add_output_data() {
            document.getElementById('addDataSpinner').hidden = false
            const outputData = document.getElementById('outputData').value
            const outputDataTags = document.getElementById('outputDataTags').value.split(':')
            const outputAlias = document.getElementById('outputDataAlias').value
            document.getElementById('outputData').value = ''
            document.getElementById('outputDataTags').value = ''
            document.getElementById('outputDataAlias').value = ''

            const body = JSON.stringify({
                output_data: outputData,
                output_tags: outputDataTags,
                output_alias: outputAlias,
            });
            send_request("POST", "/add-outputs", body, 'addDataSpinner')
        }

        // function to add output(s) to the database based on a folder path
        function add_output_folder_path() {
            document.getElementById('addFolderSpinner').hidden = false
            const outputFolderPath = document.getElementById('outputFolderPath').value
            const outputFolderTags = document.getElementById('outputFolderTags').value.split(':')
            document.getElementById('outputFolderPath').value = ''
            document.getElementById('outputFolderTags').value = ''

            const body = JSON.stringify({
                output_folder_path: outputFolderPath,
                output_tags: outputFolderTags,
            });
            send_request("POST", "/add-outputs", body, 'addFolderSpinner')
        }

        // function to remove outputs from the database
        function remove_outputs() {
            document.getElementById('removeSpinner').hidden = false
            var [data, run_starts, indexes, aliases, tags] = [{}, [], [], [], []]
            const removeRunStarts = document.getElementById('removeRunStarts').value.split(',')
            for (const runStart of removeRunStarts) {
                if (runStart == '') { continue }
                run_starts.push(runStart)
            }
            if (run_starts.length > 0) { data['run_starts'] = run_starts }
            const removeIndexes = document.getElementById('removeIndexes').value.split(';')
            for (const index of removeIndexes) {
                if (index == '') { continue }
                indexes.push(index)
            }
            if (indexes.length > 0) { data['indexes'] = indexes }
            const removeAliases = document.getElementById('removeAliases').value.split(',')
            for (const removeAlias of removeAliases) {
                if (removeAlias == '') { continue }
                aliases.push(removeAlias)
            }
            if (aliases.length > 0) { data['aliases'] = aliases }
            const removeTags = document.getElementById('removeTags').value.split(',')
            for (const removeTag of removeTags) {
                if (removeTag == '') { continue }
                tags.push(removeTag)
            }
            if (tags.length > 0) { data['tags'] = tags }
            const body = JSON.stringify(data)
            send_request("DELETE", "/remove-outputs", body, 'removeSpinner')
        }

        // function to retrieve all outputs currently in the database
        function get_outputs() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/get-outputs");
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    const runs = JSON.parse(xhr.responseText)
                    let table = '<tr><th>Run Index</th><th>Run Start</th><th>Run Name</th><th>Run Alias</th><th>Run Tags</th></tr>'
                    for (const [index, run] of runs.entries()) {
                        table += `<tr><td>${index}</td><td>${run.run_start}</td><td>${run.name}</td><td>${run.alias}</td><td>${run.tags}</td></tr>`
                    }
                    document.getElementById('runTable').innerHTML = table
                } else {
                    add_alert(`Error: ${xhr.status}, ${xhr.responseText}`, 'danger')
                }
            };
            xhr.send();
        }

        // function to set the customized view config
        function set_customized_view_config(notifications = true) {
            const adminSectionHide = localStorage.getItem('adminSectionHide') ?? '';
            const adminGraphHide = localStorage.getItem('adminGraphHide') ?? '';
            const adminSectionShow = localStorage.getItem('adminSectionShow') ?? '';
            const adminGraphShow = localStorage.getItem('adminGraphShow') ?? '';
            document.getElementById('saveHideSpinner').hidden = false
            const body = JSON.stringify({
                admin_section_hide: adminSectionHide,
                admin_graph_hide: adminGraphHide,
                admin_section_show: adminSectionShow,
                admin_graph_show: adminGraphShow,
            });
            send_request("POST", "set-customized-view-config", body, 'saveHideSpinner', notifications)
        }

        // function to get the customized view config
        function get_customized_view_config() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/get-customized-view-config");
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    const config = JSON.parse(xhr.responseText)
                    const adminSectionHide = localStorage.getItem('adminSectionHide')
                    const adminGraphHide = localStorage.getItem('adminGraphHide')
                    const adminSectionShow = localStorage.getItem('adminSectionShow')
                    const adminGraphShow = localStorage.getItem('adminGraphShow')
                    if (adminSectionHide == '' && adminGraphHide == '' && adminSectionShow == '' && adminGraphShow == '') {
                        localStorage.setItem('adminSectionHide', config.admin_section_hide)
                        localStorage.setItem('adminGraphHide', config.admin_graph_hide)
                        localStorage.setItem('adminSectionShow', config.admin_section_show)
                        localStorage.setItem('adminGraphShow', config.admin_graph_show)
                    }
                    // 2 functions below should alwyas be here to make sure the server side config is actually present
                    setup_modal_items() // fill the modal with the correct content
                    set_customized_view_config(false) // if there is a local storage already in place update that on server side
                } else {
                    add_alert(`Error: ${xhr.status}, ${xhr.responseText}`, 'danger')
                }
            };
            xhr.send();
        }

        // function to send requests (helper function for other functions that do similar server requests)
        function send_request(method, endpoint, body, spinner, notifications = true) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, endpoint);
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    document.getElementById(spinner).hidden = true
                    response = JSON.parse(xhr.responseText);
                    if (response.success == '1') {
                        console.log(response.console)
                        if (notifications) {
                            if (response.console.includes('ERROR')) {
                                add_alert('SUCCESS: The processing was handled but some errors occurred, see the browser console for more details!', 'warning')
                            } else {
                                add_alert(response.message, 'success')
                            }
                        }
                    } else {
                        add_alert(response.message, 'danger')
                        console.log(response.console)
                    }
                    get_outputs()
                } else {
                    document.getElementById(spinner).hidden = true
                    add_alert(`Error: ${xhr.status}, ${xhr.responseText}`, 'danger')
                }
            };
            xhr.send(body);
        }

        //////////////////////////////
        // CUSTOMIZE VIEW FUNCTIONS //
        //////////////////////////////

        // function to update the arrows in the customize modal
        function setup_customize_view_modal_arrows() {
            // function to move the items from showing to hidden
            function move_items(fromId, toId) {
                const fromBox = document.getElementById(fromId);
                const toBox = document.getElementById(toId);
                const selectedItems = fromBox.querySelectorAll('.active');

                if (toId.includes('Hide')) {
                    for (let item of selectedItems) {
                        var hidden = localStorage.getItem(toId)
                        hidden += `'${item.children[0].innerText}',`
                        localStorage.setItem(toId, hidden)
                    }
                    if (toId.includes('Section')) {
                        for (let item of selectedItems) {
                            const identifier = item.children[0].innerText.split(" ")[0]
                            disable_graphs_in_customize_view(true, identifier)
                        }
                    }
                } else {
                    for (let item of selectedItems) {
                        var hidden = localStorage.getItem(fromId)
                        hidden = hidden.replaceAll(`'${item.children[0].innerText}',`, '')
                        localStorage.setItem(fromId, hidden)
                    }
                    if (toId.includes('Section')) {
                        for (let item of selectedItems) {
                            const identifier = item.children[0].innerText.split(" ")[0]
                            disable_graphs_in_customize_view(false, identifier)
                        }
                    }
                }

                if (toId != 'adminGraphShow') {
                    selectedItems.forEach(item => {
                        item.classList.remove('active');
                        toBox.appendChild(item);
                    });
                } else {
                    selectedItems.forEach(item => {
                        item.classList.remove('active');
                        const section = item.children[0].innerText.split(' ')[0]
                        const listItems = document.getElementById('adminGraphShow').querySelectorAll('.hideItem')
                        var lastMatchingItem = Array.from(listItems).reverse().find(li => {
                            const div = li.children[0];
                            return div.innerText.startsWith(section)
                        });
                        if (lastMatchingItem == undefined) {
                            lastMatchingItem = listItems[listItems.length - 1]
                        }
                        lastMatchingItem.after(item);
                    });
                }
            }

            // Map the arrow actions and associated operations
            const arrowMappings = {
                'sectionRight': { from: 'adminSectionShow', to: 'adminSectionHide', content: arrowRight },
                'sectionLeft': { from: 'adminSectionHide', to: 'adminSectionShow', content: arrowLeft },
                'graphRight': { from: 'adminGraphShow', to: 'adminGraphHide', content: arrowRight },
                'graphLeft': { from: 'adminGraphHide', to: 'adminGraphShow', content: arrowLeft }
            };

            // Initialize arrows with their respective functionality and content
            for (let arrow in arrowMappings) {
                const { from, to, content } = arrowMappings[arrow];
                // Update button content based on direction
                update_arrow_button(arrow, content);
                // Add event listener to each arrow button
                document.getElementById(arrow).addEventListener("click", () => {
                    move_items(from, to);
                });
            }

            // Function to update arrow button content
            function update_arrow_button(id, content) {
                document.getElementById(id).innerHTML = content;
            }
        }

        // function to handle the setting of the localstorge for customized view
        function setup_local_storage() {
            // first load to create a string
            if (localStorage.getItem('adminSectionHide') == null) { localStorage.setItem('adminSectionHide', '') }
            if (localStorage.getItem('adminSectionShow') == null) { localStorage.setItem('adminSectionShow', '') }
            if (localStorage.getItem('adminGraphHide') == null) { localStorage.setItem('adminGraphHide', '') }
            if (localStorage.getItem('adminGraphShow') == null) { localStorage.setItem('adminGraphShow', '') }
        }

        // function to add/remove disabled to the graphs in the customize view popup
        function disable_graphs_in_customize_view(disable, identifier) {
            const relatedGraphs1 = document.getElementById("adminGraphShow").querySelectorAll(".hideItemText")
            const relatedGraphs2 = document.getElementById("adminGraphHide").querySelectorAll(".hideItemText")
            const relatedGraphs = [...relatedGraphs1, ...relatedGraphs2]
            for (const graph of relatedGraphs) {
                if (graph.innerText.startsWith(identifier)) {
                    if (disable) {
                        graph.parentElement.classList.add('disabled');
                    } else {
                        graph.parentElement.classList.remove('disabled');
                    }
                }
            }
        }

        // function to fill the customize view modal
        function setup_modal_items() {
            // function that adds the graph to the correct box
            function add_graph(graph) {
                const element = hideItem.replaceAll('{value}', graph).replaceAll('{type}', 'graph')
                var hidden = localStorage.getItem('adminGraphHide')
                if (hidden.includes(`'${graph}'`)) {
                    graphHideItems += element
                } else {
                    graphShowItems += element
                }
            }

            // GRAPHS FIRST TO BE ABLE TO DISABLE THEM BASED ON SECTIONS LATER!
            // create the graphs in the correct order if sectionshow is set
            var hideGraphsCopy = hideGraphs
            var graphShowItems = ''
            var graphHideItems = ''
            if (localStorage.getItem('adminGraphShow') != '') {
                for (let graph of localStorage.getItem('adminGraphShow').split(',')) {
                    if (graph == '') { continue }
                    graph = graph.replaceAll('\'', '')
                    hideGraphsCopy = hideGraphsCopy.filter(hiddenGraph => hiddenGraph !== graph)
                    add_graph(graph)
                }
            }
            // use the default order for the remaining items
            for (let graph of hideGraphsCopy) {
                add_graph(graph.replaceAll('\'', ''))
            }
            document.getElementById('adminGraphShow').innerHTML = graphShowItems
            document.getElementById('adminGraphHide').innerHTML = graphHideItems

            // function that adds the section to the correct box
            function add_section(section) {
                const element = hideItem.replaceAll('{value}', section).replaceAll('{type}', 'section')
                var hidden = localStorage.getItem('adminSectionHide')
                if (hidden.includes(`'${section}'`)) {
                    const identifier = section.split(' ')[0]
                    disable_graphs_in_customize_view(true, identifier)
                    sectionHideItems += element
                } else {
                    sectionShowItems += element
                }
            }

            // SECTIONS SECOND TO BE ABLE TO DISABLE THE ITEMS CORRECTLY
            // create the sections in the correct order if sectionShow is set
            var hideSectionsCopy = hideSections
            var sectionShowItems = ''
            var sectionHideItems = ''
            if (localStorage.getItem('adminSectionShow') != '') {
                for (let section of localStorage.getItem('adminSectionShow').split(',')) {
                    if (section == '') { continue }
                    section = section.replaceAll('\'', '')
                    hideSectionsCopy = hideSectionsCopy.filter(hiddenSection => hiddenSection !== section)
                    add_section(section)
                }
            }
            // use the default order for the remaining items
            for (let section of hideSectionsCopy) {
                add_section(section.replaceAll('\'', ''))
            }
            document.getElementById('adminSectionShow').innerHTML = sectionShowItems
            document.getElementById('adminSectionHide').innerHTML = sectionHideItems

            // eventlisteners for the section up buttons
            document.querySelectorAll('.section .moveUp').forEach(item => {
                item.innerHTML = arrowUpVerySmall
                item.addEventListener('click', function (event) {
                    before = $(this).parent().prev();
                    $(this).parent().insertBefore(before)
                    event.stopPropagation();
                });
            });

            // eventlisteners for the section down buttons
            document.querySelectorAll('.section .moveDown').forEach(item => {
                item.innerHTML = arrowDownVerySmall
                item.addEventListener('click', function (event) {
                    after = $(this).parent().next();
                    $(this).parent().insertAfter(after)
                    event.stopPropagation();
                });
            });

            // eventlisteners for the graph up buttons
            document.querySelectorAll('.graph .moveUp').forEach(item => {
                item.innerHTML = arrowUpVerySmall
                item.addEventListener('click', function (event) {
                    event.stopPropagation();
                    before = $(this).parent().prev();
                    if (before[0] == undefined || $(this).parent().children()[0].innerText.split(' ')[0] != before[0].innerText.split(' ')[0]) {
                        return
                    }
                    $(this).parent().insertBefore(before)
                });
            });

            // eventlisteners for the graph down buttons
            document.querySelectorAll('.graph .moveDown').forEach(item => {
                item.innerHTML = arrowDownVerySmall
                item.addEventListener('click', function (event) {
                    event.stopPropagation();
                    after = $(this).parent().next();
                    if (after[0] == undefined || $(this).parent().children()[0].innerText.split(' ')[0] != after[0].innerText.split(' ')[0]) {
                        return
                    }
                    $(this).parent().insertAfter(after)
                });
            });

            // set which sections and graphs are shown and fill the modal
            document.querySelectorAll('.hideItem').forEach(item => {
                item.addEventListener('click', function () {
                    this.classList.toggle('active');
                });
            });

            // set adminSectionShow and adminGraphShow local storage 
            var sectionShow = ''
            var graphShow = ''
            document.getElementById('adminSectionShow').querySelectorAll('.hideItem').forEach(item => {
                sectionShow += `'${item.children[0].innerText}',`
            });
            document.getElementById('adminGraphShow').querySelectorAll('.hideItem').forEach(item => {
                graphShow += `'${item.children[0].innerText}',`
            });
            localStorage.setItem('adminSectionShow', sectionShow)
            localStorage.setItem('adminGraphShow', graphShow)
        }

        ///////////////////////////
        // MAIN FUNCTION ON LOAD //
        ///////////////////////////

        // function that triggers all functions that should be executed when the dashboard is loaded first
        // in the correct order!
        function main() {
            setup_eventlisteners()
            setup_customize_view_modal_arrows()
            setup_local_storage()
            get_customized_view_config() // get server side config if it exists and update local storage (if it is not already filled) and the modal
            get_outputs()
        }

        // trigger of first load
        main()
    </script>

</body>

</html>